<div class="entry-logs-page">
  <!-- Connection Status -->
  <app-connection-status-bar />

  <!-- Header -->
  <header class="page-header">
    <button class="back-btn" (click)="onBack()" aria-label="Volver">
      <i class="bi bi-arrow-left"></i>
    </button>
    <div class="header-content">
      <h1 class="page-title">Historial de Accesos</h1>
      <h2 class="page-subtitle">Registro de ingresos y salidas</h2>
    </div>
    <div class="header-actions">
      <app-sync-status-badge />
      <button class="refresh-btn" (click)="loadEntries()" aria-label="Actualizar">
        <i class="bi bi-arrow-clockwise"></i>
      </button>
    </div>
  </header>

  <!-- Search Bar -->
  <div class="search-container">
    <i class="bi bi-search search-icon"></i>
    <input
      type="text"
      class="search-input"
      placeholder="Buscar nombre, documento o placa..."
      [value]="searchQuery()"
      (input)="onSearchChange($any($event.target).value)">
  </div>

  <!-- Filter Tabs -->
  <div class="filter-tabs">
    <button class="tab-button" [class.active]="activeFilter() === 'all'" (click)="setFilter('all')">Todos</button>
    <button class="tab-button" [class.active]="activeFilter() === 'VALID'" (click)="setFilter('VALID')">Válidas</button>
    <button class="tab-button" [class.active]="activeFilter() === 'EXPIRED'" (click)="setFilter('EXPIRED')">Expiradas</button>
    <button class="tab-button" [class.active]="activeFilter() === 'INVALID'" (click)="setFilter('INVALID')">Inválidas</button>
    <button class="tab-button" [class.active]="activeFilter() === 'REVOKED'" (click)="setFilter('REVOKED')">Revocadas</button>
  </div>

  <!-- Content -->
  <div class="logs-content">
    @if (loading()) {
      <div class="empty-state">
        <i class="bi bi-hourglass-split"></i>
        <h3>Cargando historial...</h3>
      </div>
    }

    @if (!loading()) {
      <!-- Debug counter -->
      <p style="color: #666; font-size: 12px; margin: 8px 0;">
        Total: {{ entries().length }} | Filtrados: {{ filteredEntries().length }} | Hoy: {{ todayEntries().length }} | Anteriores: {{ olderEntries().length }}
      </p>

      @if (filteredEntries().length === 0) {
        <div class="empty-state">
          <i class="bi bi-inbox"></i>
          <h3>No se encontraron registros</h3>
          <p>Los ingresos confirmados aparecerán aquí</p>
        </div>
      }

      @for (entry of filteredEntries(); track $index) {
        <div class="log-card"
             [style.border-left-color]="entry.scanResult === 'VALID' ? '#10b981' : entry.scanResult === 'EXPIRED' ? '#f59e0b' : '#ef4444'">
          <!-- Icon -->
          <div class="log-icon"
               [style.background]="entry.scanResult === 'VALID' ? '#10b98115' : '#ef444415'">
            <i class="bi"
               [class.bi-box-arrow-in-right]="entry.action !== 'EXIT'"
               [class.bi-box-arrow-right]="entry.action === 'EXIT'"
               [style.color]="entry.scanResult === 'VALID' ? '#10b981' : '#ef4444'"></i>
          </div>

          <!-- Details -->
          <div class="log-body">
            <div class="log-row-top">
              <span class="log-name">{{ entry.personName || 'Sin nombre' }}</span>
              <span class="log-badge"
                    [style.background]="entry.scanResult === 'VALID' ? '#dcfce7' : entry.scanResult === 'EXPIRED' ? '#fef3c7' : '#fee2e2'"
                    [style.color]="entry.scanResult === 'VALID' ? '#166534' : entry.scanResult === 'EXPIRED' ? '#92400e' : '#991b1b'">
                {{ getStatusLabel(entry.scanResult) }}
              </span>
            </div>
            <div class="log-meta">
              <i class="bi bi-person-vcard"></i>
              {{ entry.personDocument || 'N/A' }}
              <span class="log-dot">•</span>
              {{ getActionLabel(entry.action) }}
            </div>
            @if (entry.vehiclePlate || entry.notes) {
              <div class="log-footer">
                @if (entry.vehiclePlate) {
                  <span><i class="bi bi-car-front"></i> {{ entry.vehiclePlate }}</span>
                }
                @if (entry.notes) {
                  <span><i class="bi bi-info-circle"></i> {{ entry.notes }}</span>
                }
              </div>
            }
          </div>

          <!-- Time -->
          <div class="log-time">
            {{ entry.scannedAt | date:'shortTime' }}
          </div>
        </div>
      }
    }
  </div>

  <app-doorman-bottom-nav [activeTab]="'history'" />
</div>
