<div class="org-config">
  <!-- Header -->
  <header class="org-config__header">
    <div class="org-config__header-content">
      <div class="org-config__icon-container">
        <i class="bi bi-gear"></i>
      </div>
      <h1 class="org-config__title">Configuración</h1>
      <p class="org-config__subtitle">Ajustes de tu organización</p>
    </div>
  </header>

  <!-- Content -->
  <div class="org-config__content">
    <!-- Loading -->
    @if (isLoading()) {
      <div class="org-config__loading">
        <div class="org-config__spinner"></div>
        <p>Cargando configuración...</p>
      </div>
    }

    <!-- Success Message -->
    @if (successMessage()) {
      <output class="org-config__alert org-config__alert--success">
        <i class="bi bi-check-circle-fill"></i>
        {{ successMessage() }}
      </output>
    }

    <!-- General Error -->
    @if (generalError()) {
      <div class="org-config__alert org-config__alert--error" role="alert">
        <i class="bi bi-exclamation-triangle"></i>
        {{ generalError() }}
      </div>
    }

    <!-- Config Form -->
    @if (!isLoading()) {
      <form class="org-config__form" [formGroup]="form" (ngSubmit)="onSave()">
        <!-- Units Section -->
        <div class="org-config__section">
          <div class="org-config__section-header">
            <i class="bi bi-buildings"></i>
            <h2 class="org-config__section-title">Generación de Unidades</h2>
          </div>

          <div class="org-config__card">
            <div class="org-config__item">
              <div class="org-config__info">
                <label for="maxUnitsPerDistribution" class="org-config__label">Máximo de unidades por lote</label>
                <p class="org-config__description">Número máximo de unidades que se pueden crear en una sola operación de generación masiva.</p>
              </div>
              <div class="org-config__control">
                <input
                  id="maxUnitsPerDistribution"
                  formControlName="maxUnitsPerDistribution"
                  type="number"
                  class="org-config__input"
                  min="1"
                  max="1000"
                  [class.org-config__input--error]="form.get('maxUnitsPerDistribution')?.touched && form.get('maxUnitsPerDistribution')?.invalid" />
                @if (getErrorMessage('maxUnitsPerDistribution')) {
                  <span class="org-config__field-error">{{ getErrorMessage('maxUnitsPerDistribution') }}</span>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Owner Permission Management Section -->
        <div class="org-config__section">
          <div class="org-config__section-header">
            <i class="bi bi-shield-lock"></i>
            <h2 class="org-config__section-title">Permisos de Residentes</h2>
          </div>

          <div class="org-config__card">
            <div class="org-config__item org-config__item--toggle">
              <div class="org-config__info">
                <label class="org-config__label">Administración de permisos por propietario</label>
                <p class="org-config__description">Si está activo, los propietarios podrán seleccionar qué permisos otorgar a los residentes que inviten. Si está inactivo, los residentes heredarán los mismos permisos del propietario.</p>
              </div>
              <div class="org-config__control">
                <app-toggle-switch
                  [checked]="form.get('enableOwnerPermissionManagement')?.value"
                  (toggled)="form.get('enableOwnerPermissionManagement')?.setValue($event); hasChanges.set(true)"
                  ariaLabel="Habilitar administración de permisos por propietario" />
              </div>
            </div>
          </div>
        </div>

        <!-- Save Button -->
        <button
          type="submit"
          class="org-config__btn-save"
          [disabled]="isSaving() || !hasChanges() || form.invalid">
          @if (isSaving()) {
            <span class="org-config__spinner-sm"></span>
            Guardando...
          } @else {
            <i class="bi bi-check-lg"></i>
            Guardar cambios
          }
        </button>
      </form>
    }
  </div>

  <!-- Bottom Navigation -->
  <app-admin-bottom-nav [activeTab]="'config'" />
</div>
